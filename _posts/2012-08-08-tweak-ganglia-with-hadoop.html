---
layout: post
title: Tweak Ganglia With Hadoop
date: '2012-08-08T18:22:00.000+05:30'
author: Swathi Venkatachala
tags:
- Ganglia
- hadoop metrics
- monitoring tool
- Hadoop cluster
- CDH3 update
- Apache Hadoop
modified_time: '2012-08-12T15:47:05.606+05:30'
blogger_id: tag:blogger.com,1999:blog-6187879032785791598.post-3434908810085287694
blogger_orig_url: http://femgeekz.blogspot.com/2012/08/tweak-ganglia-with-hadoop.html
comments: true
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><span style="font-size: small;">&nbsp;&nbsp;&nbsp; Its very important to monitor all the machines in the cluster in terms of OS health, bottlenecks, performance hits and so on. There are numerous tools available which spits out huge number of graphs and statistics. But to the administrator of the cluster, only the prominent stats which seriously affects the performance or the health of the cluster, should be portrayed.<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Ganglia, fits the bill.<br />Introduction to Ganglia:<br />&nbsp;&nbsp;&nbsp; Ganglia is a scalable distributed monitoring system for high-performance computing systems such as clusters and Grids. It is based on a hierarchical design targeted at federations of clusters. It relies on a&nbsp;&nbsp;&nbsp; multicast-based listen/announce protocol to monitor state within clusters and uses a tree of point-to-point connections amongst representative cluster nodes to federate clusters and aggregate their state. It leverages widely used technologies such as XML for data&nbsp;&nbsp;&nbsp; representation, XDR for compact, portable data transport, and RRDtool for data storage and visualization. It uses carefully engineered data structures and algorithms to achieve very low per-node overheads and high concurrency.<br />&nbsp;&nbsp;&nbsp; The implementation is robust, has been ported to an extensive set of operating systems and processor architectures, and is currently in use on over 500 clusters around the world. It has been used to link clusters across university campuses and around the world and can scale to handle clusters with 2000 nodes.<br /><br />Having known bits of the fact what Ganglia is, there are some pure terminologies to be known before the kick start.<br />1. Node : Generally, it's a machine targeted to perform a single task with its (1-4)core processor.<br />2. Cluster : Cluster consists of a group of nodes.<br />3. Grid : Grid consists of group of clusters.<br /><br /><b>Heading towards Ganglia...</b><br />&nbsp;&nbsp;&nbsp; The ganglia system is comprised of two unique daemons, a PHP-based web frontend and a few other small utility programs.</span></div><div style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><span style="font-size: small;"><br />- <b>Ganglia Monitoring Daemon(gmond)</b><br />&nbsp;&nbsp;&nbsp; Gmond is a multi-threaded daemon which runs on each cluster node you want to monitor.Its responsible for monitoring changes in host state, announcing relevant changes, listening to the state of all other ganglia nodes via a unicast or multicast channel and answer requests for an XML description of the cluster state. Each gmond transmits an information in two different ways unicasting/multicasting host state in external data representation (XDR) format using UDP messages or sending XML over a TCP connection.<br />&nbsp;</span></div><div style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><span style="font-size: small;">- <b>Ganglia Meta Daemon(gmetad)</b><br />&nbsp;&nbsp;&nbsp; Ganglia Meta Daemon ("gmetad") periodically polls a collection of child data sources, parses the collected XML, saves all numeric, volatile metrics to round-robin databases and exports the aggregated XML over TCP sockets to clients. Data sources may be either "gmond" daemons, representing specific clusters, or other "gmetad" daemons, representing sets of clusters. Data sources use source IP addresses for access control and can be specified using multiple IP addresses for failover. The latter capability is natural for aggregating data from clusters since each "gmond" daemon contains the entire state of its cluster.<br />&nbsp;</span></div><div style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><span style="font-size: small;">- <b>Ganglia PHP Web Frontend</b><br />&nbsp;&nbsp;&nbsp; The Ganglia web frontend provides a view of the gathered information via real-time dynamic web pages to the system administrators.<br /><br /><b>Setting up Ganglia:</b><br />&nbsp;&nbsp;&nbsp; Assume the following:<br />- Cluster : "HadoopCluster"<br />- Nodes : "Master", "Slave1", "Slave2". {Considered only 3 nodes for examples. Similarly many nodes/slaves can be configured.}<br />- Grid : "Grid" consists of "HadoopCluster" for now.<br /><br />&nbsp;&nbsp;&nbsp; gmond is supposed to be installed on all the nodes ie. "Master", "Slave1", "Slave2". gmetad and web-frontend will be on Master. On, the Master node, we can see all the statistics in the web-frontend. However, we can have a dedicated server for web-frontend too.<br /><br /><b>Step 1</b>: Install gmond on "Master", "Slave1" and "Slave2"<br />&nbsp;&nbsp;&nbsp; Installing Ganglia can be done by downloading the respective tar.gz, extracting, configure, make and install. But, why to reinvent the wheel. Let's go by installing the same with repository.<br /><br />OS: Ubuntu 11.04<br />Ganglia version 3.1.7<br />Hadoop version CDH3 hadoop-0.20.2<br /><br />Update your repository packages.<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo apt-get update</span><br /><br />Installing depending packages.<br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo apt-get -y install build-essential libapr1-dev libconfuse-dev libexpat1-dev python-dev</span><br /><br />Installing gmond.<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$&nbsp; sudo apt-get install ganglia-monitor</span><br /><br />Making changes in /etc/ganglia/gmond.conf<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$&nbsp; sudo vi /etc/ganglia/gmond.conf</span></span><br /><blockquote><span style="font-size: small;"><span style="font-size: x-small;">/* This configuration is as close to 2.5.x default behavior as possible </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;&nbsp; The values closely match ./gmond/metric.h definitions in 2.5.x */ </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">globals {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; daemonize = yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; setuid = no</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; user = ganglia&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; debug_level = 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; max_udp_msg_len = 1472&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; mute = no&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; deaf = no&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; host_dmax = 0 /*secs */ </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; cleanup_threshold = 300 /*secs */ </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; gexec = no&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; send_metadata_interval = 0&nbsp;&nbsp;&nbsp;&nbsp; </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">} </span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;">/* If a cluster attribute is specified, then all gmond hosts are wrapped inside </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;* of a &lt;CLUSTER&gt; tag.&nbsp; If you do not specify a cluster tag, then all &lt;HOSTS&gt; will </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;* NOT be wrapped inside of a &lt;CLUSTER&gt; tag. */ </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">cluster { </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; name = "HadoopCluster" </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; owner = "Master" </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; latlong = "unspecified" </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; url = "unspecified" </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">} </span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;">/* The host section describes attributes of the host, like the location */ </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">host { </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; location = "unspecified" </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">} </span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;">/* Feel free to specify as many udp_send_channels as you like.&nbsp; Gmond </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;&nbsp; used to only support having a single channel */ </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">udp_send_channel { </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; host = Master</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; port = 8650</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; ttl = 1 </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">} </span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;">/* You can specify as many udp_recv_channels as you like as well. */ </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">udp_recv_channel { </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#&nbsp; mcast_join = 239.2.11.71</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; port = 8650 </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#&nbsp; bind = 239.2.11.71 </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">} </span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;">/* You can specify as many tcp_accept_channels as you like to share </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;&nbsp; an xml description of the state of the cluster */ </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">tcp_accept_channel { </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; port = 8649</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">} </span>...</span></blockquote><span style="font-size: small;">About the configuration changes:<br style="font-family: &quot;Trebuchet MS&quot;,sans-serif;" />&nbsp;&nbsp;&nbsp; Check the globals once. In the cluster {}, change the name of the cluster as assumed to "HadoopCluster" from unspecified, owner to "Master"( can be your organisation/admin name), latlong,url can be specified according to your location. No harm in keeping them unspecified. <br />&nbsp;&nbsp;&nbsp; As said, gmond communicates using UDP messages or sending XML over a TCP connection. So, lets get this clear!</span><br /><blockquote class="tr_bq"><span style="font-size: small;"><span style="font-size: x-small;">udp_send_channel { </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; host = Master</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; port = 8650</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; ttl = 1 </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">}&nbsp; </span>...</span></blockquote><span style="font-size: small;">means that host recieving at the end point will be "Master" (where Master is the hostname with associated IP address. Add all the hostnames in /etc/hosts with the respective IPs). The port at which it accepts is 8650.<br />Since, gmond is configured now at "Master", the UDP recieve channel is 8650.</span><br /><blockquote class="tr_bq"><span style="font-size: small;"><span style="font-size: x-small;">udp_recv_channel { </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#&nbsp; mcast_join = 239.2.11.71</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; port = 8650 </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#&nbsp; bind = 239.2.11.71 </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">} </span></span></blockquote><span style="font-size: small;">All the XML description which could be hadoop metrics, system metrics etc. is accepted at port:8649</span><br /><blockquote class="tr_bq"><span style="font-size: small;"><span style="font-size: x-small;">tcp_accept_channel { </span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; port = 8649</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">} </span>..</span></blockquote><span style="font-size: small;"><br />Starting Ganglia:<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo /etc/init.d/ganglia-monitor start</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ telnet Master 8649</span><br />Output should contain XML format.<br /><br />This means gmond is up.<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ ps aux | grep gmond</span><br />shows gmond <br /><br />Installing gmond on Slave machines is same with gmond.conf being,</span><br /><blockquote><span style="font-size: small;"><span style="font-size: x-small;">/* This configuration is as close to 2.5.x default behavior as possible</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;&nbsp; The values closely match ./gmond/metric.h definitions in 2.5.x */</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">globals {</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; daemonize = yes</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; setuid = no</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; user = ganglia</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; debug_level = 0</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; max_udp_msg_len = 1472</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; mute = no</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; deaf = no</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; host_dmax = 0 /*secs */</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; cleanup_threshold = 300 /*secs */</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; gexec = no</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; send_metadata_interval = 0</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">}</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;">/* If a cluster attribute is specified, then all gmond hosts are wrapped inside</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;* of a &lt;CLUSTER&gt; tag.&nbsp; If you do not specify a cluster tag, then all &lt;HOSTS&gt; will</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;* NOT be wrapped inside of a &lt;CLUSTER&gt; tag. */</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">cluster {</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; name = "HadoopCluster"</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; owner = "Master"</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; latlong = "unspecified"</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; url = "unspecified"</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">}</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;">/* The host section describes attributes of the host, like the location */</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">host {</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; location = "unspecified"</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">}</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;">/* Feel free to specify as many udp_send_channels as you like.&nbsp; Gmond</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;&nbsp; used to only support having a single channel */</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">udp_send_channel {</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; host = Master</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; port = 8650</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; ttl = 1</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">}</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;">/* You can specify as many udp_recv_channels as you like as well. */</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">udp_recv_channel {</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;">#&nbsp; mcast_join = 239.2.11.71</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; port = 8650</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;# bind = 239.2.11.71</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">}</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;">/* You can specify as many tcp_accept_channels as you like to share</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;&nbsp; an xml description of the state of the cluster */</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">tcp_accept_channel {</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp; port = 8649</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">}</span>....</span></blockquote><span style="font-size: small;"><br /><br />Starting Ganglia:<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo /etc/init.d/ganglia-monitor start</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ telnet Slave1 8649</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" />Output should contain XML format<br /><br /><br />This means gmond is up.<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ ps aux | grep gmond</span><br />shows gmond <br /><br /><b>Step 2</b> : Installing gmetad on Master.<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo apt-get install ganglia-webfrontend</span><br /><br />Installing the dependencies<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo apt-get -y install build-essential libapr1-dev libconfuse-dev libexpat1-dev python-dev librrd2-dev</span><br /><br />Making the required changes in gmetad.conf<br />data_source "HadoopCluster"&nbsp; Master <br />gridname "Grid"<br />setuid_username "ganglia"<br /><br />datasource specifies the cluster name as "HadoopCluster" and Master as the sole point of consolidating all the metrics and statistics.<br />gridname is assumed as "Grid" initially.<br />username is ganglia.<br /><br />Check for /var/lib/ganglia directory. If not existing then,<br />mkdir /var/lib/ganglia<br />mkdir /var/lib/ganglia/rrds/<br />and then<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo chown -R ganglia:ganglia /var/lib/ganglia/</span><br /><br />Running the gmetad<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo /etc/init.d/gmetad start</span><br /><br />You can stop with <br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo /etc/init.d/gmetad stop </span><br />and run in debugging mode once.<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ gmetad -d 1</span><br /><br />Now, restart the daemon<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo /etc/init.d/gmetad restart</span><br /><br /><b>Step 3</b> : Installing PHP Web-frontend dependent packages at "Master"<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo apt-get -y install build-essential libapr1-dev libconfuse-dev libexpat1-dev python-dev librrd2-dev</span><br /><br />Check for /var/www/ganglia directory. If not existing, then copy the contents of /usr/share/ganglia-webfrontend to /var/www/ganglia.</span><br /><span style="font-size: small;">You must be able to see graph.d and many other .php. Restart apache2.<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo /etc/init.d/apache2 restart</span><br /><br />Time to hit Web URL<br />http://Master/ganglia <br />in general, http://&lt;hostname&gt;/ganglia/<br /><br />You must be able to see some graphs.<br /><br /><br /><b>Step 4</b> : Configuring Hadoop-metrics with Ganglia.<br />On Master( Namenode, JobTracker)<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo vi /etc/hadoop-0.20/conf/hadoop-metrics.properties</span></span><br /><blockquote><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "dfs" context for null</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#dfs.class=org.apache.hadoop.metrics.spi.NullContext</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "dfs" context for file</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#dfs.class=org.apache.hadoop.metrics.file.FileContext</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#dfs.period=10</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#dfs.fileName=/tmp/dfsmetrics.log</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "dfs" context for ganglia</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;dfs.class=org.apache.hadoop.metrics.ganglia.GangliaContext31</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;dfs.period=10</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;dfs.servers=Master:8650</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "dfs" context for /metrics</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#dfs.class=org.apache.hadoop.metrics.spi.NoEmitMetricsContext</span></span><br /><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "mapred" context for null</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#mapred.class=org.apache.hadoop.metrics.spi.NullContext</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "mapred" context for /metrics</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">mapred.class=org.apache.hadoop.metrics.spi.NoEmitMetricsContext</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "mapred" context for file</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#mapred.class=org.apache.hadoop.metrics.file.FileContext</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#mapred.period=10</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#mapred.fileName=/tmp/mrmetrics.log</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "mapred" context for ganglia</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;mapred.class=org.apache.hadoop.metrics.ganglia.GangliaContext31</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;mapred.period=10</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;mapred.servers=Master:8650</span></span><br /><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "jvm" context for null</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#jvm.class=org.apache.hadoop.metrics.spi.NullContext</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "jvm" context for /metrics</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">jvm.class=org.apache.hadoop.metrics.spi.NoEmitMetricsContext</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "jvm" context for file</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#jvm.class=org.apache.hadoop.metrics.file.FileContext</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#jvm.period=10</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#jvm.fileName=/tmp/jvmmetrics.log</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "jvm" context for ganglia</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;jvm.class=org.apache.hadoop.metrics.ganglia.GangliaContext31</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;jvm.period=10</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;jvm.servers=Master:8650</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "rpc" context for null</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#rpc.class=org.apache.hadoop.metrics.spi.NullContext</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "rpc" context for /metrics</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">rpc.class=org.apache.hadoop.metrics.spi.NoEmitMetricsContext</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "rpc" context for file</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#rpc.class=org.apache.hadoop.metrics.file.FileContext</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#rpc.period=10</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#rpc.fileName=/tmp/rpcmetrics.log</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "rpc" context for ganglia</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;rpc.class=org.apache.hadoop.metrics.ganglia.GangliaContext31</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;rpc.period=10</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;rpc.servers=Master:8650</span></span></blockquote><span style="font-size: small;"><br />Hadoop provides a way to access all the metrics with GangliaContext31 class.<br />Restart hadoop services at Master.<br />Restart gmond and gmetad.<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ telnet Master 8649</span><br />will spit XML metrics of Hadoop<br /><br />On Slave1 (Secondary Namenode, Datanode, TaskTracker)<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo gedit /etc/hadoop-0.20.2/conf/hadoop-metrics.properties </span></span><br /><blockquote><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "dfs" context for file</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#dfs.class=org.apache.hadoop.metrics.file.FileContext</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#dfs.period=10</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#dfs.fileName=/tmp/dfsmetrics.log</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "dfs" context for ganglia</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;dfs.class=org.apache.hadoop.metrics.ganglia.GangliaContext31</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;dfs.period=10</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;dfs.servers=Master:8650</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "dfs" context for /metrics</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#dfs.class=org.apache.hadoop.metrics.spi.NoEmitMetricsContext</span></span><br /><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "mapred" context for null</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#mapred.class=org.apache.hadoop.metrics.spi.NullContext</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "mapred" context for /metrics</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;mapred.class=org.apache.hadoop.metrics.spi.NoEmitMetricsContext</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "mapred" context for file</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#mapred.class=org.apache.hadoop.metrics.file.FileContext</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#mapred.period=10</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#mapred.fileName=/tmp/mrmetrics.log</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "mapred" context for ganglia</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;mapred.class=org.apache.hadoop.metrics.ganglia.GangliaContext31</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;mapred.period=10</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;mapred.servers=Master:8650</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "jvm" context for null</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#jvm.class=org.apache.hadoop.metrics.spi.NullContext</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "jvm" context for /metrics</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">jvm.class=org.apache.hadoop.metrics.spi.NoEmitMetricsContext</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "jvm" context for file</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#jvm.class=org.apache.hadoop.metrics.file.FileContext</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#jvm.period=10</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#jvm.fileName=/tmp/jvmmetrics.log</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "jvm" context for ganglia</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;jvm.class=org.apache.hadoop.metrics.ganglia.GangliaContext31</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;jvm.period=10</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;jvm.servers=Master:8650</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "rpc" context for null</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#rpc.class=org.apache.hadoop.metrics.spi.NullContext</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "rpc" context for /metrics</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">rpc.class=org.apache.hadoop.metrics.spi.NoEmitMetricsContext</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "rpc" context for file</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#rpc.class=org.apache.hadoop.metrics.file.FileContext</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#rpc.period=10</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">#rpc.fileName=/tmp/rpcmetrics.log</span></span><br /><br /><span style="font-size: small;"><span style="font-size: x-small;"># Configuration of the "rpc" context for ganglia</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;rpc.class=org.apache.hadoop.metrics.ganglia.GangliaContext31</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;rpc.period=10</span></span><br /><span style="font-size: small;"><span style="font-size: x-small;">&nbsp;rpc.servers=Master:8650</span></span></blockquote><span style="font-size: small;">Restart the datanode, tasktracker with the command<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo service hadoop-0.20-tasktracker restart</span></span><br /><span style="font-size: small;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo service hadoop-0.20-datanode restart</span></span><br /><span style="font-size: small;">Restart gmond<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ telnet Master 8649</span><br />will spit the XML format of Hadoop metrics for this host Slave1<br /><br />Similar procedure done to Slave1 must be followed for Slave2 and then restarting the services of hadoop and gmond.<br /><br />On the Master, <br />Restart gmond and gmetad with<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo /etc/init.d/ganglia-monitor restart</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo /etc/init.d/gmetad restart</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><br />Hit the web URL<br />http://Master/ganglia<br />Check for Metrics, Grid, Cluster and all the nodes you configured for.<br />You can also witness the hosts up, hosts down, total CPUs. Lots more in store!<br />&nbsp;</span><br /><span style="font-size: small;">Enjoy monitoring your cluster! :)</span></div></div>
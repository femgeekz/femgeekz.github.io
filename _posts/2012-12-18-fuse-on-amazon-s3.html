---
layout: post
title: FUSE on Amazon S3
date: '2012-12-18T17:36:00.001+05:30'
author: Swathi Venkatachala
tags:
- precise pangolin
- s3fs
- ubuntu
- s3cmd
- FUSE
- s3
- source forge
- aws
- file system
- Amazon Web Services
- open source
- sync
modified_time: '2012-12-18T22:53:37.439+05:30'
blogger_id: tag:blogger.com,1999:blog-6187879032785791598.post-4091208116836196751
blogger_orig_url: http://femgeekz.blogspot.com/2012/12/fuse-on-amazon-s3.html
comments: true
---

<span style="font-family: 'Trebuchet MS', sans-serif;"><b>FUSE</b>: File System In User Space, hosted on sourceforge, a well known open source project <a href="http://fuse.sourceforge.net/">http://fuse.sourceforge.net/</a></span><br /><span style="font-family: Trebuchet MS, sans-serif;">You either put the files in S3 bucket directly or in the mount point, both will always be in the same&nbsp;hierarchy&nbsp;and in Sync. The best thing is that any arbitrary program can just point to this mount point and perform simple/ normal commands, rather than&nbsp;file system&nbsp;specific commands.</span><br /><span style="font-family: Trebuchet MS, sans-serif;"><br /></span><span style="font-family: Trebuchet MS, sans-serif;">Here is a small documentation about how we can achieve this.</span><br /><span style="font-family: Trebuchet MS, sans-serif;"><br /></span><span style="font-family: Trebuchet MS, sans-serif;">1. &nbsp;Check out the code from google code.</span><br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$ svn checkout http://s3fs.googlecode.com/svn/trunk/ s3fs</span></blockquote><span style="font-family: Trebuchet MS, sans-serif;"><br /></span><span style="font-family: Trebuchet MS, sans-serif;">2. Switch to the working directory</span><br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$ cd s3fs</span></blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$ ls</span>&nbsp;</blockquote><blockquote class="tr_bq"><span style="font-family: 'Courier New', Courier, monospace;">AUTHORS &nbsp;autogen.sh &nbsp;ChangeLog &nbsp;configure.ac &nbsp;COPYING &nbsp;doc &nbsp;INSTALL &nbsp;Makefile.am &nbsp;NEWS &nbsp;README &nbsp;src &nbsp;test</span></blockquote><span style="font-family: Trebuchet MS, sans-serif;"><br /></span><span style="font-family: Trebuchet MS, sans-serif;">3. Now same old ritual of configure , make and install.</span><br /><span style="font-family: Trebuchet MS, sans-serif;">To run the subsequent command you need autoconf. So make sure you have it by running the following command.</span><br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$ sudo apt-get install autoconf</span><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">$ autoreconf --install&nbsp;</span></blockquote><blockquote class="tr_bq"><span style="font-family: 'Trebuchet MS', sans-serif;">It is silently notifying you that you lack the libraries. Time to get them installed...</span></blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$ sudo apt-get install build-essential libfuse-dev fuse-utils libcurl4-openssl-dev libxml2-dev mime-support</span></blockquote><span style="font-family: Trebuchet MS, sans-serif;"><br /></span><span style="font-family: Trebuchet MS, sans-serif;">Getting back...</span><br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$ ./configure --prefix=/usr</span></blockquote><blockquote class="tr_bq"><span style="font-family: 'Courier New', Courier, monospace;">$ make</span></blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$ sudo make install</span></blockquote><span style="font-family: Trebuchet MS, sans-serif;"><br /></span><span style="font-family: Trebuchet MS, sans-serif;">4. Done with the Installation process.</span><br /><span style="font-family: Trebuchet MS, sans-serif;">Cross-check:</span><br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$ /usr/bin/s3fs&nbsp;</span>&nbsp;</blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">s3fs: missing BUCKET argument</span><span style="font-family: Courier New, Courier, monospace;">Usage: s3fs BUCKET:[PATH] MOUNTPOINT [OPTION]...</span></blockquote><span style="font-family: Trebuchet MS, sans-serif;"><br /></span><span style="font-family: Trebuchet MS, sans-serif;">5. Add the following line to your ~/.bashrc file and source it.</span><br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">export s3fs=/usr/bin/s3fs</span></blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$source ~/.bashrc</span><span style="font-family: Courier New, Courier, monospace;">$ s3fs&nbsp;</span><span style="font-family: Courier New, Courier, monospace;">s3fs: missing BUCKET argument</span><span style="font-family: Courier New, Courier, monospace;">Usage: s3fs BUCKET:[PATH] MOUNTPOINT [OPTION]...</span></blockquote><span style="font-family: Trebuchet MS, sans-serif;"><br /></span><span style="font-family: Trebuchet MS, sans-serif;">6. Install s3cmd. Many of you must be using this tool to interact with s3.</span><br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$ sudo apt-get install s3cmd</span><span style="font-family: Courier New, Courier, monospace;">$ s3cmd --configure&nbsp;</span></blockquote><span style="font-family: Trebuchet MS, sans-serif;">This will configure with the S3 account using Access and Secret Key.</span><br /><span style="font-family: Trebuchet MS, sans-serif;"><br /></span><span style="font-family: Trebuchet MS, sans-serif;"><b>Configuring FUSE</b></span><br /><span style="font-family: Trebuchet MS, sans-serif;">1. First set use_allow_other for others to use. Uncomment in fuse.conf</span><br /><blockquote class="tr_bq"><span style="font-family: 'Courier New', Courier, monospace;">$ vi /etc/fuse.conf</span></blockquote><span style="font-family: Trebuchet MS, sans-serif;"><br /></span><span style="font-family: Trebuchet MS, sans-serif;">2. Set the AcessKey:SecretKey in the format in passwd-s3fs file</span><br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$ sudo vi /etc/passwd-s3fs</span></blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$ sudo chmod 640 /etc/passwd-s3fs</span></blockquote><span style="font-family: 'Trebuchet MS', sans-serif;">3. Created a bucket called "s3dir-sync" for this experiment.</span><br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$ s3cmd ls</span><span style="font-family: Courier New, Courier, monospace;">2012-12-18 09:23 &nbsp;s3://s3dir-sync</span></blockquote><span style="font-family: 'Trebuchet MS', sans-serif;">4. Creating a mount point where you want to dump/place the files and keep them in sync with the S3 bucket. Create as root user.</span><br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$ sudo mkdir -p /mnt/s3Sync</span><span style="font-family: Courier New, Courier, monospace;">$ sudo chmod 777 /mnt/s3Sync</span></blockquote><span style="font-family: Trebuchet MS, sans-serif;"><br /></span><span style="font-family: Trebuchet MS, sans-serif;">5. With s3fs, as a root user.</span><br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$ sudo s3fs s3dir-sync -o default_acl=public-read -o allow_other /mnt/</span><span style="font-family: 'Courier New', Courier, monospace;">s3Sync</span><span style="font-family: Courier New, Courier, monospace;">/</span></blockquote><span style="font-family: Trebuchet MS, sans-serif;">Cross-check:</span><br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$ mount -l</span><span style="font-family: Courier New, Courier, monospace;">s3fs on /mnt/s3Sync&nbsp;type fuse.s3fs (rw,nosuid,nodev,allow_other)</span></blockquote><span style="font-family: 'Trebuchet MS', sans-serif;">If you try mounting again, you will get the following Warning</span><br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">mount: according to mtab, s3fs is already mounted on /mnt/s3Sync</span></blockquote><span style="font-family: Trebuchet MS, sans-serif;"><br /></span><span style="font-family: Trebuchet MS, sans-serif;">6. I created a directory structure of&nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace;">/mnt/s3Sync/</span><br /><span style="font-family: Courier New, Courier, monospace;">-&gt; 2012/12/18$ more test.txt</span><br /><span style="font-family: Courier New, Courier, monospace;">This is a check file to sync with the s3dir-sync.</span><br /><span style="font-family: Courier New, Courier, monospace;">Blah..!</span><br /><span style="font-family: Trebuchet MS, sans-serif;"><br /></span><span style="font-family: Trebuchet MS, sans-serif;">The same is synced in the bucket "s3dir-sync"</span><br /><span style="font-family: Trebuchet MS, sans-serif;">Cross-Check:&nbsp;</span><br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">$ s3cmd ls s3://s3dir-sync</span></blockquote><blockquote class="tr_bq"><span style="font-family: 'Courier New', Courier, monospace;">DIR &nbsp; s3://s3dir-sync/2012/</span></blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">2012-12-18 09:57 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; s3://s3dir-sync/2012</span></blockquote><div><span style="font-family: Trebuchet MS, sans-serif;"><br /></span></div><span style="font-family: Trebuchet MS, sans-serif;">Happy Learning! :)</span>